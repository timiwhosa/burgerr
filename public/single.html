<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Burger bread single product page">
    <meta name="keywords" content="bread, burger, burger house, cart,nigeria bread, bread in nigeria, best breads, akure, breads in akure, bakery">
    <meta name="author" content="@ifo_tim">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burger PAN Bread || single product</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="general-info" id="general-info"></div>
    <div id="menu" class="menu"></div>
    <nav> </nav>
    <div class="container">
        <div class="single" id="single">
            <!-- <h2>Burger PAN Bread </h2>
            <h4>WHITE LOAF</h4>
            <img src="/img/product/bread2.jpg" alt="">
            <div>
                <p>Nourishing white loaf specially prepared for you by our team of specialist.</p>
                <p>Enjoy while hot with friends and family!!</p>
            </div>
            <h2 >N500</h2 >
            <div class="btn">
                <button>ORDER NOW</button>
                <button>ADD TO CART</button>
            </div> -->
            <div class="order-cover" id="ordercover" onclick="ordernow()"></div>
            <div class="order" id="order">
                <div class="order-div1" id="order-div1">
                    <span class="order-step">1/2</span>
                    <h2>ORDER TYPE</h2>
                    <p>select the best delivery mode that sooths your order.</p>
                    <div class="home-del">
                        <h4>HOME DELIVERY</h4>
                        <p>Goods delivered to your door step,</p>
                        <p>Urgently or not, we are always on time.</p>
                        <div class="order-btn">
                            <button onclick=" selectdelmode('urgent')">URGENT <span class="smalltxt">delivery fee of N50</span></button>
                            <button onclick=" selectdelmode('normal')">NORMAL <span class="smalltxt smalltxt2">free </span></button>
                        </div>
                    </div>
                    <div class="booking-del">
                        <h4>BOOKING</h4>
                        <p>Got an occasion? or need large supplies</p>
                        <p>We've got you covered</p>
                        <div>
                            <button onclick=" selectdelmode('booking')">BOOK NOW</button>
                        </div>
                    </div>

                </div>
                <div class="order-div1" id="order-div2">
                    <span class="order-step">2/2</span>
                    <h2>ORDER DETAILS</h2>
                    <div class="order-type">
                        <p>Order type</p>
                        <div class="form" >
                            <select name="order" onchange="modes()" id="order-type">
                                <option value="normal" >NORMAL</option>
                                <option value="urgent" >URGENT</option>
                                <option value="booking" >BOOKING</option>
                            </select>
                        </div>
                    </div>
                    <div class="order-type-div">
                        <div class="order-type-div1" id="order-type-div1">
                            <div class="form">
                                <div class="top">
                                    <div class="">
                                        <p>Name:</p>
                                        <input type="text" name="" id="urgent-name" class="inp-small" placeholder="For reference" required>
                                    </div>
                                    <div class="">
                                        <p>Phone number:</p>
                                        <input type="number" name="" id="urgent-phone" class="inp-small" placeholder="080****" required minlength="11">
                                    </div>
                                </div>
                                <p>Location</p>
                                <textarea name="" id="urgent-location" cols="20" rows="4" placeholder="Could be popular building in your area" required></textarea>
                                <p>Deadline <span class="smalltxt3">between working hours and 30min from request time</span></p>
                                <input type="time" name="" id="urgent-deadline" class="inp-big" placeholder="8:30am" required>

                                <p><button type="submit" id="form1" onclick="urgentreq()">CONFIRM</button></p>
                            </div>
                        </div>
                        <div class="order-type-div1" id="order-type-div2">
                            <div class="form" >
                                <div class="top">
                                    <div class="">
                                        <p>Name:</p>
                                        <input type="text" name="" id="normal-name" class="inp-small" placeholder="For reference" required>
                                    </div>
                                    <div class="">
                                        <p>Phone number:</p>
                                        <input type="number" name="" id="normal-phone" class="inp-small" placeholder="080****" required minlength="11">
                                    </div>
                                </div>
                                <p>Location</p>
                                <textarea name="" id="normal-location" cols="20" rows="4" placeholder="Could be popular building in your area" required></textarea>
                                <p>Additional info <span class="smalltxt3">comment or instruction</span></p>
                                <input type="text" name="" id="normal-add-info" class="inp-big" placeholder="short note pls" required>

                                <p><button type="submit" id="form2" onclick="normalreq()" >CONFIRM</button></p>
                            </div>
                        </div>
                        <div class="order-type-div1" id="order-type-div3">
                            <div class="form"  >
                                <div class="top">
                                    <div class="">
                                        <p>Name:</p>
                                        <input type="text" name="" id="booking-name" class="inp-small" placeholder="For reference" required>
                                    </div>
                                    <div class="">
                                        <p>Phone number:</p>
                                        <input type="number" name="" id="booking-phone" class="inp-small" placeholder="080****" required minlength="11">
                                    </div>
                                </div>
                                <p>Location</p>
                                <textarea name="" id="booking-location" cols="20" rows="2" placeholder="Could be popular building in your area" required></textarea>
                                <p>Request</p>
                                <textarea name="" id="booking-request" cols="30" rows="6" placeholder="Say it and we do it" required></textarea>
                                
                                <!-- <p>Deadline <span class="smalltxt3">between working hours and 30min from request time</span></p>
                                <input type="number" name="" id="booking-deadline" class="inp-big" placeholder="8:30am" required> -->

                                <p><button type="submit" id="form3"  onclick="bookingreq()">CONFIRM</button></p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="all-others" style="margin: 10vh 0 0; text-align: center; font-weight: 600; text-decoration: underline;">
            <a id="viewall">VIEW ALL <span id="viewallspan"></span></a>
        </div>


        <h3>Other Delicious Pastries</h3>
        <div class="other-products-div" id="other-products-div"></div>
    </div>
    <!-- script -->
    <script src="/index.js"></script>
    <script src="/nav.js"></script>

    <script>
        var prod = window.location.pathname.split("/")[2];
        var prodname  =window.location.pathname.split("/")[3]
        var prodid =window.location.pathname.split("/")[4];
        var va = document.getElementById("viewall");
        var vas = document.getElementById("viewallspan");
        va.setAttribute("href", `/product/${prod}`);
        vas.innerHTML = prod.toLocaleUpperCase();
        var j ="";
        var prod2 = "";
        var all2="";
        var others = [];
        var hl = [];
        var singleproduct="";
        function fetchproduct(){
            var url = `/products`;
            var h = new Headers();
            h.append("Accept", "application/json");
            var req = new Request({
                method:"get",
                headers: h,
                mode:"cors"
            });

            fetch(url,req).then((res)=>{
                return res.json();
            }).then((data)=>{
                j = data;
                singleproduct = data[prod].filter((prodd)=>{
                    return prodd.name == prodname.replace(/%20/g, " ") && prodd.id ==prodid
                });

                loadprod(singleproduct)
                // console.log(singleproduct);
                prod2 = data;
                delete prod2[prod];
                all2 = data.all;
                var ind = prod2.all.indexOf(`${prod}`);
                all2.splice(ind,1);
                // console.log(prod2);
                othersfill(prod2, all2)
            }).catch((err)=>{
                console.log(err);
            })
        }
        fetchproduct();

        function loadprod(data){
            // console.log()
            var complement="";
            if(prod=="bread"){
                complement="Enjoy while hot with friends and family!!";
            }
            else if(prod=="shawarma"){
                complement="Enjoy while hot with friends and family!!";
            }
            else if(prod=="birthday-cupcake"){
                complement="Enjoy lovely birthday cupcakes with friends and family!!";
            }
            else{
                complement="Enjoy with friends and family!!";
            }
            var productDiv = document.getElementById("single");
                productDiv.innerHTML += `
                <h2>Burger PAN ${prod} </h2>
                <h4>${data[0].name}</h4>
                <img src="${data[0].image}" alt="burger house| burger bread ${data[0].image}">
                <div>
                    <p>${data[0].description}</p>
                    <p>${complement}</p>
                </div>
                <h2 >N${data[0].price}</h2 >
                <div class="btn">
                    <button onclick="ordernow()">ORDER NOW</button>
                    <button onclick="addtocart('${data[0].type}','${data[0].name}','${data[0].price}',${data[0].id},'${data[0].image}')">ADD TO CART</button>
                </div>`;
            
        }


        function loadothers(data){
            var productDiv = document.getElementById("other-products-div");
            for(let i = 0; i<data.length; i++){
                productDiv.innerHTML += `
                <div class="product">
                    <div class="product-img-div">
                        <a href="/single/${data[i].type}/${data[i].name.replace(/s\g/,"%20")}/${data[i].id}">
                            <img src="${data[i].image}" alt="burger house| burger bread ${data[i].image}">
                        </a>
                        <span id="addtocart" class="addtocart" onclick="addtocart('${data[i].type}','${data[i].name}','${data[i].price}',${data[i].id},'${data[i].image}')"> &#128722;</span>
                    </div>
                    <div class="description">${data[i].name}</div>
                    <div class="price">N${data[i].price}</div>
                </div>`;
            }
        }

        function myran(l, y) {
            let one = y + 1;
            let two = Math.random() * one;
            let result = Math.floor(two) + l;
            // console.log("result:", result);
            return result;
        }

        function othersfill(data, all2){
            // function helo(){
            for(let i = 0; i<all2.length; i++){
                for(let j = 0; j<4; j++){
                    others.push(data[all2[i]][j])
                }
            }
            // console.log(others);
            var hh = others.length

            for (let m =0; m< hh; m++){
                var used =  myran(0, others.length -1);
                // console.log(used);
                hl.push(others[used]);
                // console.log(others[used]);
                others.splice(used, 1);
                // console.log(others);
            }
            loadothers(hl);
        }

        function addtocart(category,description,price,id, img){
            var tag = category + id;
            allproduct(tag);
            var cartproduct = JSON.parse(localStorage.getItem("cartproduct"));
            if(cartproduct){
                if(cartproduct[tag] != undefined){
                    cartproduct[tag].incart += 1;
                    localStorage.setItem("cartproduct", JSON.stringify(
                   cartproduct, null ,2));
                }
                else{
                    cartproduct[tag] = {
                        category,
                        description,
                        price,
                        id,
                        img,
                        incart: 1
                    }
                    localStorage.setItem("cartproduct", JSON.stringify(
                   cartproduct, null ,2));
                }
                incartno()
            }
            else{
                data = {
                    category,
                    description,
                    price,
                    id,
                    img,
                    incart: 1
                }
                localStorage.setItem("cartproduct", JSON.stringify(
                   { [tag] : data}, null ,2));
                   incartno()
            }
        }

        function incartno(){
            var catno = parseInt(localStorage.getItem("noincart"));
            if(catno){
                localStorage.setItem("noincart", catno + 1);
                noincart();
            }
            else{
                localStorage.setItem("noincart",1);
                noincart();
            }
        }

        String.prototype.escape = function(){
            var tagtoreplace = {
                "&":"&amp;",
                "<":"&lt",
                ">":"&gt",
                "script":" ",
                "Script":" ",
                '"':" ",
                "`":" "
            };
            return this.replace(/[&<>`]/g, function(tag){
                return tagtoreplace[tag] || tag;
            });
        }

        function noincart(){
            var nobefore = parseInt(localStorage.getItem("noincart"));
            // console.log( nobefore);
            if(nobefore){
                document.getElementById("cartno").innerHTML = nobefore;
                document.getElementById("cartno2").innerHTML = nobefore;
            }
            else{
                document.getElementById("cartno").innerHTML = 0;
                document.getElementById("cartno2").innerHTML = 0;
            }
        }
        noincart();

        function allproduct(product){
            var allproduct = JSON.parse(localStorage.getItem("allproducts"));
            // console.log("allproduct",allproduct)
            if(allproduct){
                var test = allproduct.filter((bk)=>{
                    return bk == product;
                });
                    // console.log("test", test)
                if(test.length == 0){
                    allproduct.push(product);
                    // console.log(allproduct)
                    localStorage.setItem("allproducts",JSON.stringify(allproduct));
                }

            }
            else{
                localStorage.setItem("allproducts",JSON.stringify([product]));
            }
        }


        // ORDER SECRION
          function selectdelmode(mode){
            document.getElementById("order-div1").style.left = "-340px";
            document.getElementById("order-div2").style.left = "10px";
            document.getElementById("order").style.height = "496px ";
            document.getElementById("order-type").value = mode;
            if(mode =="urgent"){
                mode1();
            }
            else if(mode =="normal"){
                mode2();
            }
            else if(mode =="booking"){
                mode3();
            }
        }

        function modes(){
            var mode = document.getElementById("order-type").value;
            if(mode =="urgent"){
                mode1();
            }
            else if(mode =="normal"){
                mode2();
            }
            else if(mode =="booking"){
                mode3();
            }

        }

        function mode1(mode){
            document.getElementById("order-type-div1").style.left = "10px";
            document.getElementById("order-type-div2").style.left = "340px";
            document.getElementById("order-type-div3").style.left = "340px";
        }
        function mode2(mode){
            document.getElementById("order-type-div1").style.left = "-340px";
            document.getElementById("order-type-div2").style.left = "10px";
            document.getElementById("order-type-div3").style.left = "340px";
        }
        function mode3(mode){
            document.getElementById("order-type-div1").style.left = "-340px";
            document.getElementById("order-type-div2").style.left = "-340px";
            document.getElementById("order-type-div3").style.left = "10px";
        }

        var ord = 1;
        function ordernow(){
            if(ord==1){
                document.getElementById("order").style.display = "block";
                document.getElementById("ordercover").style.display = "block";
                ord=2;
            }
            else if(ord==2){
                document.getElementById("order").style.display = "none";
                document.getElementById("ordercover").style.display = "none";
                ord=1;
            }

        }
// var fp = singleproduct;
//             fp[incart] = 1;
//             var product = fp;
//             var allproduct = [`${prod}`];

        // document.getElementById("form1").addEventListener("click",
        function urgentreq(){
            // e.preventDefault();
            var name = document.getElementById("urgent-name").value.escape();
            var phone = document.getElementById("urgent-phone").value.escape();
            var location = document.getElementById("urgent-location").value.escape();
            var deadline = document.getElementById("urgent-deadline").value.escape();
            var fp = {
                [`${prod + singleproduct[0].id}`] : {
                                "category": singleproduct[0].type,
                                "description": singleproduct[0].name,
                                "price": singleproduct[0].price,
                                "id": singleproduct[0].id,
                                "img": singleproduct[0].image,
                                "incart": 1
                            }
            };
            var product = fp;
            var allproduct = [`${prod + singleproduct[0].id }`];
            if(name.trim() !="" && phone.trim() !="" && location.trim() !="" && deadline.trim() !=""){
                var url = "/order/urgent"
                var option = {
                        method : "POST",
                        headers: {"content-type": "application/json"},
                        body: JSON.stringify({
                            name, phone,location, deadline, product,allproduct
                        })
                    }
                fetch(url, option).then((res)=>{
                    return res.json();
                }).then((data)=>{
                    alert(data.message);
                    ordernow()
                }).catch((err)=>{
                    console.log(err);
                });
            }
            else{
                alert("Pls help fill the form completely so as to process your order..")
            }
        }
        // );

        // document.getElementById("form2").addEventListener("click",
        function normalreq(){
            // e.preventDefault();
            var name = document.getElementById("normal-name").value.escape();
            var phone = document.getElementById("normal-phone").value.escape();
            var location = document.getElementById("normal-location").value.escape();
            var addinfo = document.getElementById("normal-add-info").value.escape();
            var fp = {
                [`${prod + singleproduct[0].id}`] : {
                                "category": singleproduct[0].type,
                                "description": singleproduct[0].name,
                                "price": singleproduct[0].price,
                                "id": singleproduct[0].id,
                                "img": singleproduct[0].image,
                                "incart": 1
                            }
            };
            var product = fp;
            var allproduct = [`${prod + singleproduct[0].id }`];
            if(name.trim() !="" && phone.trim() !="" && location.trim() !="" && addinfo.trim() !=""){
                var url = "/order/normal"
                var option = {
                        method : "POST",
                        headers: {"content-type": "application/json"},
                        body: JSON.stringify({
                            name, phone,location, addinfo, product,allproduct
                        })
                    }
                fetch(url, option).then((res)=>{
                    return res.json();
                }).then((data)=>{
                    alert(data.message);
                    ordernow();
                }).catch((err)=>{
                    console.log(err);
                });
            }
            else{
                alert("Pls help fill the form completely so as to process your order..")
            }
        }
        // );

        // document.getElementById("form3").addEventListener("click",
         function bookingreq(){
            // e.preventDefault();
            var name = document.getElementById("booking-name").value.escape();
            var phone = document.getElementById("booking-phone").value.escape();
            var location = document.getElementById("booking-location").value.escape();
            var request = document.getElementById("booking-request").value.escape();
            var fp = {
                [`${prod + singleproduct[0].id}`] : {
                                "category": singleproduct[0].type,
                                "description": singleproduct[0].name,
                                "price": singleproduct[0].price,
                                "id": singleproduct[0].id,
                                "img": singleproduct[0].image,
                                "incart": 1
                            }
            };
            var product = fp;
            var allproduct = [`${prod + singleproduct[0].id }`];
            if(name.trim() !="" && phone.trim() !="" && location.trim() !="" && request.trim() !=""){    
                var url = "/order/booking"
                var option = {
                        method : "POST",
                        headers: {"content-type": "application/json"},
                        body: JSON.stringify({
                            name, phone,location, request, product,allproduct
                        })
                    }
                fetch(url, option).then((res)=>{
                    return res.json();
                }).then((data)=>{
                    alert(data.message);
                    ordernow();
                }).catch((err)=>{
                    console.log(err);
                });
            }
            else{
                alert("Pls help fill the form completely so as to process your order..")
            }
        }
        // );
    </script>
</body>
</html>